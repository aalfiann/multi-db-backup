services:
  # =====================================
  # PostgreSQL / Supabase backup service
  # =====================================
  backup-postgres:
    build:
      context: .
      dockerfile: Dockerfile.backup
    restart: no
    environment:
      - POSTGRES_HOST=db.example.com
      - POSTGRES_PORT=5432
      - POSTGRES_DB=mydatabase
      - POSTGRES_USER=myuser
      - POSTGRES_PASSWORD=mypassword
      - BACKUP_NAME=postgres
      - RETENTION_DAYS=7
      - REMOTE=b2
      - REMOTE_PATH=<your-bucket-name>/postgres
      - B2_ACCOUNT_ID=<keyID>
      - B2_ACCOUNT_KEY=<applicationKey>
    volumes:
      - ./common:/common
    entrypoint: ["/bin/bash", "/common/backup.sh"]

  # =====================================
  # MySQL / MariaDB backup service
  # =====================================
  backup-mysql:
    build:
      context: .
      dockerfile: Dockerfile.backup
    restart: no
    environment:
      - MYSQL_HOST=db.example.com
      - MYSQL_PORT=3306
      - MYSQL_DATABASE=mydb
      - MYSQL_USER=myuser
      - MYSQL_PASSWORD=mypassword
      - BACKUP_NAME=mysql
      - RETENTION_DAYS=7
      - REMOTE=b2
      - REMOTE_PATH=<your-bucket-name>/mysql
      - B2_ACCOUNT_ID=<keyID>
      - B2_ACCOUNT_KEY=<applicationKey>
    volumes:
      - ./common:/common
    entrypoint: ["/bin/bash", "/common/backup.sh"]

  # =====================================
  # MongoDB backup service
  # =====================================
  # backup-mongo:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile.backup
  #   restart: no
  #   environment:
  #     - MONGO_URI=mongodb+srv://user:pass@cluster.mongodb.net/mydb
  #     - BACKUP_NAME=mongo
  #     - RETENTION_DAYS=7
  #     - REMOTE=b2
  #     - REMOTE_PATH=<your-bucket-name>/mongo
  #     - B2_ACCOUNT_ID=<keyID>
  #     - B2_ACCOUNT_KEY=<applicationKey>
  #   volumes:
  #     - ./common:/common
  #   entrypoint: ["/bin/bash", "/common/backup.sh"]

  # =====================================
  # Folder backup service
  # =====================================
  # backup-app-folders:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile.backup
  #   restart: no
  #   environment:
  #     - BACKUP_SOURCES=/home/app/web:/home/app/backend  # Multiple folders separate with colon
  #     - RETENTION_DAYS=7
  #     - BACKUP_NAME=app-folders
  #     - REMOTE=b2
  #     - REMOTE_PATH=<your-bucket-name>/app-folders
  #     - B2_ACCOUNT_ID=<keyID>
  #     - B2_ACCOUNT_KEY=<applicationKey>
  #   volumes:
  #     - ./common:/common
  #     - /home/app/web:/home/app/web:ro
  #     - /home/app/backend:/home/app/backend:ro
  #   entrypoint: ["/bin/bash", "/common/backup.sh"]

  # =====================================
  # Rclone uploader (common tool)
  # =====================================
  rclone:
    image: rclone/rclone:latest
    container_name: rclone
    volumes:
      - ./common:/common
      - ./common/rclone.conf:/root/.config/rclone/rclone.conf:ro
    entrypoint: [ "rclone" ]